import os

# 1. Création du dossier input et du faux fichier "malware"
os.makedirs("/home/user/RR/input", exist_ok=True)
malware_path = "/home/user/RR/input/malware_test.exe"

malware_content = """MZ
SUSPICIOUS_PATTERN_1
SUSPICIOUS_PATTERN_2
MALWARE_TEST_STRING
EVIL_FUNCTION
SYSTEM_CALL
NETWORK_ACCESS
ENCRYPTED_DATA
SHELL_CODE"""

with open(malware_path, "w") as f:
    f.write(malware_content)
print(f"Fichier malware simulé créé: {malware_path}")

# 2. Création du dossier rules et d'une règle YARA de test
yara_dir = "/home/user/RR/rules"
os.makedirs(yara_dir, exist_ok=True)

rule_content = """
rule SimulatedMalware
{
    meta:
        description = "Règle de détection de malware simulé"
        author = "ChatGPT"
        date = "2025-06-14"

    strings:
        $mz = "MZ"
        $pattern1 = "SUSPICIOUS_PATTERN_1"
        $malware = "MALWARE_TEST_STRING"
        $network = "NETWORK_ACCESS"
        $shellcode = "SHELL_CODE"

    condition:
        any of them
}
"""

rule_path = os.path.join(yara_dir, "simulated_malware.yar")
with open(rule_path, "w") as r:
    r.write(rule_content)

print(f"Règle YARA créée: {rule_path}")
